<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dragon's Lair</title>
    <style>
      html, body { margin:0; padding:0; background:#0b0f18; color:#e7eaf3; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; }
      #hud { display:flex; gap:16px; align-items:center; padding:10px 12px; background:#111828; position:sticky; top:0; border-bottom:1px solid #223; }
      .stat { background:#141b2d; padding:6px 10px; border-radius:8px; border:1px solid #243047; }
      .btn { background:#1b2437; padding:6px 10px; border-radius:8px; border:1px solid #2a3854; cursor:pointer; }
      .btn:disabled { opacity:.5; cursor:not-allowed; }
      #root { display:flex; gap:16px; padding:12px; }
      #leftCol { display:flex; flex-direction:column; gap:12px; }
      #game { background:#0e1526; border:1px solid #223; border-radius:8px; }
      #rightCol { display:flex; flex-direction:column; gap:12px; width:340px; }
      .panel { background:#0f1628; border:1px solid #223; border-radius:10px; padding:10px; }
      .pTitle { font-weight:700; margin-bottom:8px; }
      .uRow { display:flex; align-items:center; justify-content:space-between; margin:6px 0; gap:8px; }
      .uRow small { opacity:.8; }
      .gridHelp { font-size:12px; opacity:.8; }
    </style>
  </head>
  <body>
    <div id="hud">
      <div class="stat">Wave: <span id="wave">1</span></div>
      <div class="stat">HP: <span id="dragonHP">100</span></div>
      <div class="stat">Gold: <span id="gold">0</span></div>
      <div class="stat">Bones: <span id="bones">0</span></div>
      <button id="startBtn" class="btn">Start Wave</button>
      <label class="stat"><input id="autoStart" type="checkbox" /> Auto-start</label>
      <button id="saveBtn" class="btn">Save</button>
      <button id="loadBtn" class="btn">Load</button>
      <span id="msg" style="margin-left:auto; opacity:.8"></span>
    </div>

    <div id="root">
      <div id="leftCol">
        <canvas id="game" width="768" height="512"></canvas>
        <div class="panel gridHelp">
          Build Mode: Click empty tiles to add walls (50 bones). Walls cannot fully block the path.
          Right-click a wall to remove (refund 25 bones).
        </div>
      </div>
      <div id="rightCol">
        <div class="panel">
          <div class="pTitle">Upgrades</div>
          <div id="upgrades"></div>
        </div>
        <div class="panel">
          <div class="pTitle">Next Wave</div>
          <div id="preview"></div>
        </div>
      </div>
    </div>

<div id="bootStatus" style="position:fixed;left:8px;bottom:8px;background:#300;padding:6px 10px;border:1px solid #933;border-radius:8px;font:12px/1.2 system-ui;display:none;z-index:99999"></div>
<script>
  (function () {
    var box = document.getElementById('bootStatus');
    function show(msg){ if(!box) return; box.style.display='block'; box.textContent=String(msg); }
    window.addEventListener('error', function (e) { show('Error: ' + (e.message || e.error)); });
    window.addEventListener('unhandledrejection', function (e) { show('Promise: ' + (e.reason && e.reason.message || e.reason)); });
    window.addEventListener('dl-boot-ok', function () { if (box) box.style.display = 'none'; });
  })();
</script>
    
    <!-- Let main.js own all wiring; no inline GameState or custom events here -->
    <script type="module" src="./main.js?v=8"></script>
  
  <script>
  window.addEventListener("error", (event) => {
    const msg = document.getElementById("msg");
    if (msg) {
      msg.textContent = "⚠️ " + event.message;
      msg.style.color = "orange";
    }
  });

  window.addEventListener("unhandledrejection", (event) => {
    const msg = document.getElementById("msg");
    if (msg) {
      msg.textContent = "⚠️ Promise error: " + (event.reason?.message || event.reason);
      msg.style.color = "orange";
    }
  });
</script>
  </body>
</html>
